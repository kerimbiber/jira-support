{% extends "base.html" %}

{% block title %}SQL Sorgularƒ± ‚Äì Destek Merkezi{% endblock %}
{% block page_title %}üóÑÔ∏è SQL Sorgularƒ±{% endblock %}

{% block topbar_actions %}
    <a href="{{ url_for('sql_query_new') }}" class="btn btn-primary">
        <span>Ôºã</span> Yeni SQL Sorgusu
    </a>
{% endblock %}

{% block extra_styles %}
<style>
    .search-bar {
        background: var(--white);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: flex-end;
    }
    .search-bar .form-group { margin-bottom: 0; flex: 1; min-width: 180px; }

    .queries-list {
        display: flex;
        flex-direction: column;
        gap: 14px;
        margin-bottom: 28px;
    }

    .query-card {
        background: var(--white);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px 24px;
        text-decoration: none;
        display: block;
        transition: box-shadow 0.2s, transform 0.18s, border-color 0.2s;
        position: relative;
        overflow: hidden;
    }
    .query-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; bottom: 0;
        width: 4px;
        background: linear-gradient(180deg, #6366f1, #a855f7);
        border-radius: 4px 0 0 4px;
        opacity: 0;
        transition: opacity 0.2s;
    }
    .query-card:hover {
        box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        transform: translateY(-2px);
        border-color: var(--primary);
    }
    .query-card:hover::before { opacity: 1; }

    .query-card-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 6px;
    }

    .query-card-purpose {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 10px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .query-card-preview {
        background: #1e1e2e;
        border-radius: 8px;
        padding: 10px 14px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        color: #cdd6f4;
        white-space: pre;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: 60px;
        line-height: 1.5;
    }

    .query-card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 11.5px;
        color: var(--text-secondary);
        margin-top: 12px;
    }

    .empty-state {
        text-align: center;
        padding: 60px 24px;
        color: var(--text-secondary);
    }
    .empty-state .empty-icon { font-size: 52px; margin-bottom: 14px; }
    .empty-state h3 { font-size: 17px; color: var(--text-primary); margin-bottom: 6px; }
    .empty-state p { font-size: 13.5px; margin-bottom: 20px; }

    .results-info {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 14px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Search -->
<form method="get" action="{{ url_for('sql_queries_list') }}" class="search-bar">
    <div class="form-group">
        <label for="q">Ara</label>
        <input type="text" id="q" name="q" class="form-control"
               placeholder="Ba≈ülƒ±k, ama√ß veya SQL kodu‚Ä¶" value="{{ search }}">
    </div>
    <button type="submit" class="btn btn-primary" style="height:38px;align-self:flex-end;">üîç Ara</button>
    {% if search %}
        <a href="{{ url_for('sql_queries_list') }}" class="btn btn-secondary" style="height:38px;align-self:flex-end;">‚úï Temizle</a>
    {% endif %}
</form>

{% if queries %}
    <p class="results-info">
        {% if search %}
            "<strong>{{ search }}</strong>" i√ßin {{ total }} sonu√ß
        {% else %}
            Toplam {{ total }} SQL sorgusu
        {% endif %}
    </p>

    <div class="queries-list">
        {% for q in queries %}
        <a href="{{ url_for('sql_query_detail', query_id=q['id']) }}" class="query-card">
            <div class="query-card-title">üóÑÔ∏è {{ q['title'] }}</div>
            {% if q['purpose'] %}
                <div class="query-card-purpose">{{ q['purpose'] }}</div>
            {% endif %}
            <div class="query-card-preview">{{ q['sql_code'][:200] }}</div>
            <div class="query-card-footer">
                <span>üìÖ {{ q['updated_at'][:10] }}</span>
                <span>G√ºncellendi: {{ q['updated_at'][11:16] }}</span>
            </div>
        </a>
        {% endfor %}
    </div>

{% else %}
    <div class="empty-state">
        <div class="empty-icon">üóÑÔ∏è</div>
        {% if search %}
            <h3>Sonu√ß bulunamadƒ±</h3>
            <p>Arama kriterlerinize uyan SQL sorgusu bulunamadƒ±.</p>
            <a href="{{ url_for('sql_queries_list') }}" class="btn btn-secondary">T√ºm√ºn√º G√∂ster</a>
        {% else %}
            <h3>Hen√ºz SQL sorgusu yok</h3>
            <p>ƒ∞lk SQL sorgunuzu eklemek i√ßin a≈üaƒüƒ±daki butona tƒ±klayƒ±n.</p>
            <a href="{{ url_for('sql_query_new') }}" class="btn btn-primary">Ôºã ƒ∞lk Sorguyu Ekle</a>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
